@model KPISolution.Models.ViewModels.KPI.KpiViewModel
@using KPISolution.Models.Enums

@{
    ViewData["Title"] = "Tạo mới PI";
}

<div class="container-fluid px-4 py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-1">
                    <li class="breadcrumb-item"><a asp-action="Index">PI</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Tạo mới</li>
                </ol>
            </nav>
            <h1 class="h2 mb-0">Tạo chỉ số hiệu suất mới</h1>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="card shadow-sm">
                <div class="card-header bg-transparent">
                    <h5 class="mb-0">Thông tin PI</h5>
                </div>
                <div class="card-body">
                    <form asp-action="Create" method="post">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h6 class="fw-bold mb-3">Thông tin cơ bản</h6>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label asp-for="DepartmentId" class="form-label">Phòng ban</label>
                                            <select asp-for="DepartmentId" asp-items="ViewBag.Departments"
                                                class="form-select select2">
                                                <option value="">-- Chọn phòng ban --</option>
                                            </select>
                                            <span asp-validation-for="DepartmentId" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label asp-for="Code" class="form-label">Mã PI</label>
                                            <input asp-for="Code" class="form-control" placeholder="VD: PI001" />
                                            <span asp-validation-for="Code" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group mb-3">
                                            <label asp-for="Name" class="form-label">Tên chỉ số</label>
                                            <input asp-for="Name" class="form-control"
                                                placeholder="Nhập tên chỉ số hiệu suất" />
                                            <span asp-validation-for="Name" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label asp-for="Category" class="form-label">Danh mục</label>
                                            <select asp-for="Category" class="form-select">
                                                <option value="">-- Chọn danh mục --</option>
                                                <option value="Tài chính">Tài chính</option>
                                                <option value="Khách hàng">Khách hàng</option>
                                                <option value="Quy trình nội bộ">Quy trình nội bộ</option>
                                                <option value="Học hỏi và phát triển">Học hỏi và phát triển</option>
                                                <option value="Khác">Khác</option>
                                            </select>
                                            <span asp-validation-for="Category" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label asp-for="ResponsiblePerson" class="form-label">Người chịu trách
                                                nhiệm</label>
                                            <select asp-for="ResponsiblePerson" asp-items="ViewBag.Users"
                                                class="form-select select2">
                                                <option value="">-- Chọn người chịu trách nhiệm --</option>
                                            </select>
                                            <span asp-validation-for="ResponsiblePerson" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label asp-for="ActivityType" class="form-label">Loại hoạt động</label>
                                            <select asp-for="ActivityType" class="form-select">
                                                <option value="">-- Chọn loại hoạt động --</option>
                                                @foreach (var type in Enum.GetValues(typeof(ActivityType)))
                                                {
                                                    <option value="@((int)type)">@type.ToString()</option>
                                                }
                                            </select>
                                            <span asp-validation-for="ActivityType" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label asp-for="PerformanceLevel" class="form-label">Mức hiệu suất</label>
                                            <select asp-for="PerformanceLevel" class="form-select">
                                                <option value="">-- Chọn mức hiệu suất --</option>
                                                <option value="Cá nhân">Cá nhân</option>
                                                <option value="Nhóm">Nhóm</option>
                                                <option value="Bộ phận">Bộ phận</option>
                                                <option value="Công ty">Công ty</option>
                                            </select>
                                            <span asp-validation-for="PerformanceLevel" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group mb-3">
                                            <label asp-for="Description" class="form-label">Mô tả</label>
                                            <textarea asp-for="Description" class="form-control" rows="3"
                                                placeholder="Mô tả chi tiết về chỉ số hiệu suất"></textarea>
                                            <span asp-validation-for="Description" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <h6 class="fw-bold mb-3">Đo lường và mục tiêu</h6>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label asp-for="MeasurementDirection" class="form-label">Chiều hướng đo
                                                lường</label>
                                            <select asp-for="MeasurementDirection" class="form-select">
                                                @foreach (MeasurementDirection direction in Enum.GetValues(typeof(MeasurementDirection)))
                                                {
                                                    <option value="@direction">@(direction == MeasurementDirection.HigherIsBetter ? "Cao hơn là tốt hơn" : 
                                                                               direction == MeasurementDirection.LowerIsBetter ? "Thấp hơn là tốt hơn" : 
                                                                               direction == MeasurementDirection.TargetIsBest ? "Đạt đúng mục tiêu" : 
                                                                               "Nằm trong phạm vi")</option>
                                                }
                                            </select>
                                            <span asp-validation-for="MeasurementDirection" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label asp-for="Frequency" class="form-label">Tần suất đo lường</label>
                                            <select asp-for="Frequency" class="form-select">
                                                <option value="">-- Chọn tần suất --</option>
                                                @foreach (MeasurementFrequency frequency in Enum.GetValues(typeof(MeasurementFrequency)))
                                                {
                                                    <option value="@frequency">@(frequency == MeasurementFrequency.Daily ? "Hàng ngày" :
                                                                              frequency == MeasurementFrequency.Weekly ? "Hàng tuần" :
                                                                              frequency == MeasurementFrequency.Biweekly ? "Hai tuần một lần" :
                                                                              frequency == MeasurementFrequency.Monthly ? "Hàng tháng" :
                                                                              frequency == MeasurementFrequency.Quarterly ? "Hàng quý" :
                                                                              frequency == MeasurementFrequency.Semiannually ? "Nửa năm" :
                                                                              frequency == MeasurementFrequency.Annually ? "Hàng năm" : "Tùy chỉnh")</option>
                                                }
                                            </select>
                                            <span asp-validation-for="Frequency" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label asp-for="TargetValue" class="form-label">Giá trị mục tiêu</label>
                                            <input asp-for="TargetValue" class="form-control" placeholder="VD: 95" />
                                            <span asp-validation-for="TargetValue" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label asp-for="Unit" class="form-label">Đơn vị</label>
                                            <input asp-for="Unit" class="form-control" placeholder="VD: %" />
                                            <span asp-validation-for="Unit" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label asp-for="Weight" class="form-label">Trọng số (%)</label>
                                            <input asp-for="Weight" class="form-control" placeholder="VD: 10" />
                                            <span asp-validation-for="Weight" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label asp-for="Status" class="form-label">Trạng thái</label>
                                            <select asp-for="Status" class="form-select">
                                                <option value="@(KpiStatus.Draft)">Chưa bắt đầu</option>
                                                <option value="@(KpiStatus.Active)">Hoạt động</option>
                                            </select>
                                            <span asp-validation-for="Status" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label asp-for="EffectiveDate" class="form-label">Ngày hiệu lực</label>
                                            <input asp-for="EffectiveDate" type="date" class="form-control" />
                                            <span asp-validation-for="EffectiveDate" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group mb-3">
                                            <label asp-for="KpiType" class="form-label">Loại chỉ số</label>
                                            <select asp-for="KpiType" class="form-select">
                                                <option value="PI">Chỉ số hiệu suất (PI)</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group mb-3">
                                            <label asp-for="Formula" class="form-label">Công thức tính toán</label>
                                            <input asp-for="Formula" class="form-control"
                                                placeholder="VD: (Số đơn hàng hoàn thành / Tổng số đơn hàng) * 100%" />
                                            <span asp-validation-for="Formula" class="text-danger"></span>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group mb-3">
                                            <label asp-for="ActionPlan" class="form-label">Kế hoạch hành động</label>
                                            <textarea asp-for="ActionPlan" class="form-control" rows="3"
                                                placeholder="Nhập kế hoạch hành động để đạt mục tiêu"></textarea>
                                            <span asp-validation-for="ActionPlan" class="text-danger"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="fw-bold mb-3">Liên kết CSF</h6>
                                <div class="form-group">
                                    <label class="form-label">Yếu tố thành công quan trọng liên quan</label>
                                    <select name="SelectedCsfs" multiple class="form-select select2"
                                        data-placeholder="Chọn các CSF liên quan">
                                        @foreach (var csf in ViewBag.CSFs)
                                        {
                                            <option value="@csf.Value">@csf.Text</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <a asp-action="Index" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left me-1"></i>Quay lại
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save me-1"></i>Lưu chỉ số hiệu suất
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        $(document).ready(function () {
            $('.select2').select2({
                theme: 'bootstrap-5'
            });
        });
    </script>
}